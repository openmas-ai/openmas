[tox]
envlist = lint, py310, py310-mcp, py310-grpc, py310-mqtt, example-00-hello-agent, coverage
isolated_build = True
skipsdist = False

[testenv]
description = Run the core framework unit tests and core integration tests
deps =
    -e .[dev]
allowlist_externals =
    pytest
commands =
    pytest {toxinidir}/tests/unit {toxinidir}/tests/integration/core {posargs}

[testenv:lint]
description = Run linting checks
deps =
    -e .[dev]
allowlist_externals =
    black
    isort
    flake8
    mypy
commands =
    black --check {toxinidir}/src {toxinidir}/tests
    isort --check {toxinidir}/src {toxinidir}/tests
    flake8 {toxinidir}/src {toxinidir}/tests
    mypy --config-file=mypy.ini {toxinidir}/src {toxinidir}/tests

[testenv:py310-mcp]
description = Run integration tests for MCP with MCP dependencies installed
deps =
    -e .[dev,mcp]
allowlist_externals =
    pytest
commands =
    pytest {toxinidir}/tests/integration/mcp -m mcp {posargs}

[testenv:py310-grpc]
description = Run integration tests for gRPC with gRPC dependencies installed
deps =
    -e .[dev,grpc]
allowlist_externals =
    pytest
commands =
    pytest {toxinidir}/tests/integration/grpc -m grpc {posargs}

[testenv:py310-mqtt]
description = Run integration tests for MQTT with MQTT dependencies installed
deps =
    -e .[dev,mqtt]
allowlist_externals =
    pytest
commands =
    pytest {toxinidir}/tests/integration/mqtt -m mqtt {posargs}

[testenv:example-00-hello-agent]
description = Test the 00_hello_agent/hello_agent_example
deps =
    # For framework testing, we directly use the development version of openmas
    -e .
    # Pull in the example's dependencies
    -r {toxinidir}/examples/00_hello_agent/hello_agent_example/requirements.txt
allowlist_externals =
    pytest
changedir = {toxinidir}/examples/00_hello_agent/hello_agent_example
commands =
    pytest test_example.py {posargs}

[testenv:coverage]
description = Run all tests with all optional dependencies installed and generate coverage report
deps =
    -e .[dev,all]
allowlist_externals =
    pytest
commands =
    pytest {toxinidir}/tests --cov=src/openmas --cov-report=term --cov-report=xml:coverage.xml {posargs}
